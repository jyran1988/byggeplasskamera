version: "3.8"
services:
  fetcher:
    build: .
    restart: unless-stopped
    environment:
      # Example: two sources (id=url). Separate with comma or semicolon.
      - SOURCES=cam1=https://hurumbrygge.info/cam1visning/kamera1.jpg,cam2=https://hurumbrygge.info/cam2visning/kamera2.jpg
      - INTERVAL_SECONDS=${INTERVAL_SECONDS:-3600}
      # Root of storage for multiple sources; fetcher will write to $STORAGE_ROOT/<id>/images
      - STORAGE_ROOT=/data
      # Backwards-compat: per-container single-source storage dir
      - STORAGE_DIR=/data/images
    volumes:
      - ./data:/data
    command: python -u src/fetcher.py

  web:
    build: .
    restart: unless-stopped
    environment:
      - STORAGE_DIR=/data/images
    volumes:
      - ./data:/data
    ports:
      - "80:5000"
    command: python -u src/web_server.py
    depends_on:
      - fetcher
